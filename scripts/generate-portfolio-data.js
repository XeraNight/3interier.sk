const fs = require('fs');
const path = require('path');

const portfolioDir = path.join(__dirname, '../public/img/portfolio');
const outputFile = path.join(__dirname, '../js/portfolio-data.js');

const categories = ['vizualizacie', 'realizacie', 'nabytok'];

const portfolioData = [];

categories.forEach(category => {
    const categoryDir = path.join(portfolioDir, category);
    if (!fs.existsSync(categoryDir)) return;

    const projects = fs.readdirSync(categoryDir, { withFileTypes: true })
        .filter(dirent => dirent.isDirectory())
        .map(dirent => dirent.name);

    projects.forEach(projectFolder => {
        const projectPath = path.join(categoryDir, projectFolder);
        const images = fs.readdirSync(projectPath)
            .filter(file => /\.(jpg|jpeg|png|webp)$/i.test(file))
            .sort(); // Sort to ensure consistent order

        if (images.length === 0) return;

        // Create a slug from the folder name
        const id = projectFolder
            .toLowerCase()
            .replace(/á/g, 'a').replace(/ä/g, 'a').replace(/č/g, 'c').replace(/ď/g, 'd')
            .replace(/é/g, 'e').replace(/ě/g, 'e').replace(/í/g, 'i').replace(/ľ/g, 'l')
            .replace(/ĺ/g, 'l').replace(/ň/g, 'n').replace(/ó/g, 'o').replace(/ô/g, 'o')
            .replace(/ŕ/g, 'r').replace(/ř/g, 'r').replace(/š/g, 's').replace(/ť/g, 't')
            .replace(/ú/g, 'u').replace(/ů/g, 'u').replace(/ý/g, 'y').replace(/ž/g, 'z')
            .replace(/\s+/g, '-')
            .replace(/[^a-z0-9-]/g, '');

        portfolioData.push({
            id: id,
            category: category,
            title: projectFolder, // Use folder name as title
            folder: projectFolder,
            thumbnail: images[0], // Use first image as thumbnail
            images: images
        });
    });
});

const fileContent = `// This file is auto-generated by scripts/generate-portfolio-data.js
export const portfolioData = ${JSON.stringify(portfolioData, null, 4)};
`;

fs.writeFileSync(outputFile, fileContent);
console.log(`Generated portfolio data with ${portfolioData.length} projects to ${outputFile}`);
